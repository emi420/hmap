(this.webpackJsonpeworkmap=this.webpackJsonpeworkmap||[]).push([[0],{130:function(e,t,r){e.exports=r(168)},166:function(e,t,r){},167:function(e,t,r){},168:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(33),c=r.n(o),s=r(57),i=r(53),u=r(113),l=r(24),p=r.n(l),f=r(19),b=r(108),E=r.n(b),y=r(109),S=r.n(y),m=function(){var e;return{getService:function(){return e||(e=this)},setToken:function(e){e.access&&localStorage.setItem("access_token",e.access),e.refresh&&localStorage.setItem("refresh_token",e.refresh)},getAccessToken:function(){return localStorage.getItem("access_token")},getRefreshToken:function(){return localStorage.getItem("refresh_token")},clearToken:function(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}}}(),d=m.getService(),O=[-64.273833,-31.006031],T=m.getService(),g=E.a.create({baseURL:"https://api.hmap.forodeincendiosforestales.org/api",withCredentials:!0});!function(e){e.interceptors.request.use((function(e){var t=d.getAccessToken();return t&&(e.headers.Authorization="Bearer "+t),e}),(function(e){Promise.reject(e)})),e.interceptors.response.use((function(e){return e}),(function(t){var r=t.config;if(403===t.response.status&&!r._retry){if(!d.getRefreshToken())throw t;return r._retry=!0,e.post("v1/token/refresh/",{refresh:d.getRefreshToken()}).then((function(t){if(200===t.status)return d.setToken(t.data),e.defaults.headers.common.Authorization="Bearer "+d.getAccessToken(),e(r)}))}return Promise.reject(t)}))}(g);var _={postAccountToken:function(e,t){return g.post("v1/token/",{email:e,password:t})},logout:function(){console.log(S.a.get()),T.clearToken()},getMe:function(){return g.get("v1/accounts/me/")},getUserLayers:function(){return g.get("v1/layers/")}},v=p.a.mark(G),h=p.a.mark(R),j=p.a.mark(P),L=p.a.mark(D),I=p.a.mark(C),w=p.a.mark(V),U=p.a.mark(M),A=p.a.mark(B),x=p.a.mark(F),k=m.getService();function G(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(f.b)(_.getLatestModis24);case 3:return e=t.sent,t.next=6,Object(f.c)({type:"GET_LATEST_MODIS_24_SUCCESS",payload:e});case 6:return t.abrupt("return",t.sent);case 9:t.prev=9,t.t0=t.catch(0),console.error("[SAGA ERROR]",t.t0);case 12:case"end":return t.stop()}}),v,null,[[0,9]])}function R(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(f.b)(_.getLatestViirs24);case 3:return e=t.sent,t.next=6,Object(f.c)({type:"GET_LATEST_VIIRS_24_SUCCESS",payload:e});case 6:return t.abrupt("return",t.sent);case 9:t.prev=9,t.t0=t.catch(0),console.error("[SAGA ERROR]",t.t0);case 12:case"end":return t.stop()}}),h,null,[[0,9]])}function P(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(f.b)(_.getLatestGoes);case 3:return e=t.sent,t.next=6,Object(f.c)({type:"GET_LATEST_GOES_SUCCESS",payload:e});case 6:return t.abrupt("return",t.sent);case 9:t.prev=9,t.t0=t.catch(0),console.error("[SAGA ERROR]",t.t0);case 12:case"end":return t.stop()}}),j,null,[[0,9]])}function D(e){var t,r,n,a;return p.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,r=t.email,n=t.password,a={},o.prev=2,o.next=5,Object(f.b)(_.postAccountToken,r,n);case 5:a=o.sent,k.setToken(a.data),a.isLoggedIn=!0,o.next=13;break;case 10:o.prev=10,o.t0=o.catch(2),a={error:o.t0};case 13:return o.next=15,Object(f.c)({type:"SUBMIT_USER_AUTH_SUCCESS",payload:a});case 15:return o.abrupt("return",o.sent);case 16:case"end":return o.stop()}}),L,null,[[2,10]])}function C(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={isLoggedIn:!1},t.prev=1,t.next=4,Object(f.b)(_.logout);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),e={error:t.t0};case 9:return t.next=11,Object(f.c)({type:"SUBMIT_LOGOUT_SUCCESS",payload:e});case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),I,null,[[1,6]])}function V(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={},t.prev=1,t.next=4,Object(f.b)(_.getMe);case 4:e=t.sent.data,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),e={error:t.t0};case 10:return t.next=12,Object(f.c)({type:"SUBMIT_GET_ME_SUCCESS",payload:e});case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),w,null,[[1,7]])}function M(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={},t.prev=1,t.next=4,Object(f.b)(_.getUserLayers);case 4:e=t.sent.data,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),e={error:t.t0};case 10:return t.next=12,Object(f.c)({type:"SUBMIT_GET_USER_LAYERS_SUCCESS",payload:e});case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),U,null,[[1,7]])}function B(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("GET_LATEST_MODIS_24_EVENT",G);case 2:return e.next=4,Object(f.d)("GET_LATEST_VIIRS_24_EVENT",R);case 4:return e.next=6,Object(f.d)("GET_LATEST_GOES_EVENT",P);case 6:return e.next=8,Object(f.d)("SUBMIT_USER_AUTH_EVENT",D);case 8:return e.next=10,Object(f.d)("SUBMIT_GET_ME_EVENT",V);case 10:return e.next=12,Object(f.d)("SUBMIT_LOGOUT_EVENT",C);case 12:return e.next=14,Object(f.d)("GET_USER_LAYERS_EVENT",M);case 14:case"end":return e.stop()}}),A)}function F(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.a)([B()]);case 2:case"end":return e.stop()}}),x)}var N=r(4),Y=r(20),H={PUBLIC:Symbol.for("LayerType.PUBLIC"),PRIVATE:Symbol.for("LayerType.PRIVATE"),ACTIVE_FIRES:Symbol.for("LayerType.ACTIVE_FIRES"),BIG_FIRES:Symbol.for("LayerType.BIG_FIRES"),all:function(){return new Set([H.PUBLIC,H.PRIVATE,H.ACTIVE_FIRES,H.BIG_FIRES])}},J=Object.freeze(H);function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(r,!0).forEach((function(t){Object(N.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var z=function(){var e=localStorage.getItem("VISIBLE_LAYERS_KEY");return e?new Set(JSON.parse(e).map(Symbol.for)):J.all()},Z=function(e){return localStorage.setItem("VISIBLE_LAYERS_KEY",e&&JSON.stringify(Object(Y.a)(e).map(Symbol.keyFor)))},K=function(){return localStorage.removeItem("VISIBLE_LAYERS_KEY")},Q=function(){return{VisibleLayerTypes:z()}},X=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_LATEST_MODIS_24_SUCCESS":return q({},e,{FIRMSLatestModis24Data:t.payload.data});case"GET_LATEST_VIIRS_24_SUCCESS":return q({},e,{FIRMSLatestViirs24Data:t.payload.data});case"GET_LATEST_GOES_SUCCESS":return q({},e,{GoesLatestData:t.payload.data});case"SUBMIT_USER_AUTH_SUCCESS":return q({},e,{UserAuthData:t.payload});case"SUBMIT_GET_ME_SUCCESS":return q({},e,{GetMeData:t.payload});case"SUBMIT_LOGOUT_SUCCESS":if(!1===t.payload.isLoggedIn)return K(),Q();case"SUBMIT_GET_USER_LAYERS_SUCCESS":return q({},e,{UserLayersData:t.payload});case"TOGGLE_LAYER_TYPE_VISIBILITY":var r=t.payload.layerType,n=new Set(e.VisibleLayerTypes);return n.has(r)?n.delete(r):n.add(r),Z(n),q({},e,{VisibleLayerTypes:n});default:return e}},$=Object(u.a)();var ee=function(){var e=Object(i.d)(X,Object(i.a)($));return $.run(F),e};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var te=r(15),re=r(225),ne=r(221),ae=r(219),oe=r(224),ce=r(70),se=function(e){var t=[];return e.layers.map((function(r){-1===e.hiddenLayers.indexOf(r.id)&&(r.data?t.push(a.a.createElement(ce.a,{id:r.id,name:r.id,key:r.id,data:r.data||null,symbolLayout:r.symbolLayout,symbolPaint:r.symbolPaint,linePaint:r.linePaint,circlePaint:r.circlePaint,fillPaint:r.fillPaint,circleOnClick:function(e){console.log(e.lngLat)}})):t.push(r.layer))})),t},ie={container:{display:"flex",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",alignItems:"center",justifyContent:"center",outline:"none"},form:{container:{background:"white",width:"400px",borderRadius:"8px",padding:"20px",boxShadow:"0 2px 4px rgba(0, 0, 0, .2), 0 8px 16px rgba(0, 0, 0, .2)"},inputs:{display:"flex",flexDirection:"column",gap:"10px"}}},ue=r(220),le=r(217);function pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pe(r,!0).forEach((function(t){Object(N.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var be=function(e){var t=e.open,r=e.setOpen,n=e.onSubmit;return a.a.createElement(ue.a,{disableEnforceFocus:!0,open:t,onClose:function(){return r(!1)}},a.a.createElement(oe.a,{sx:ie.container},a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),n(e.target.email.value,e.target.password.value)},style:ie.form.container},a.a.createElement("div",{style:fe({},ie.form.inputs)},a.a.createElement(le.a,{focused:!0,label:"Email",id:"email",name:"email",required:!0}),a.a.createElement(le.a,{label:"Password",type:"password",id:"password",name:"password",required:!0}),a.a.createElement(re.a,{type:"submit"},"Login")))))},Ee=r(222),ye=r(226);var Se=function(){return a.a.createElement(Ee.a,{sx:{color:"#fff",zIndex:function(e){return 9999}},open:!0},a.a.createElement(ye.a,{color:"inherit"}))},me=r(230),de=r(228),Oe=r(229),Te=r(231),ge=r(232),_e=r(227),ve=r(223),he=r(51),je=r(110),Le=r.n(je);function Ie(e,t){if(!e||!e.length)return null;for(var r=0;r<e[0].length;r++)if(-1!==t.indexOf(e[0][r]))return e[0][r];return null}var we=function(e){var t=function(e,t){t=t||",";for(var r=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),n=[[]],a=null;a=r.exec(e);){var o,c=a[1];c.length&&c!==t&&n.push([]),o=a[2]?a[2].replace(new RegExp('""',"g"),'"'):a[3],n[n.length-1].push(o)}return n}(e),r=Ie(t,["lat","Lat","LAT","latitude","Latitude","LATITUDE"]),n=Ie(t,["lng","Lng","LNG","lon","Lon","LON","longitude","Longitude","LONGITUDE"]);return Le.a.parse(function(e,t,r){return e.map((function(e){return e.hasOwnProperty(t)&&(e[t]=parseFloat(e[t])),e.hasOwnProperty(r)&&(e[r]=parseFloat(e[r])),e}))}(function(e){if(!e||!e.length)return null;var t=e[0],r=e.map((function(e){var r={},n=0;return t.forEach((function(t){r[t]=e[n++]})),r}));return r.shift(),r}(t),r,n),{Point:[r,n]})},Ue=J.all(),Ae=(Object(he.a)([function(e){return e?e.FIRMSLatestModis24Data:{}}],(function(e){return we(e)})),Object(he.a)([function(e){return e?e.FIRMSLatestViirs24Data:{}}],(function(e){return we(e)})),Object(he.a)([function(e){return e?e.GoesLatestData:{}}],(function(e){return e||{features:[]}})),Object(he.a)([function(e){return e?e.UserAuthData:{}}],(function(e){return e||{}}))),xe=Object(he.a)([function(e){return e?e.GetMeData:{}}],(function(e){return e||{}})),ke=Object(he.a)([function(e){return e?e.UserLayersData:[]}],(function(e){return e||[]})),Ge=Object(he.a)([function(e){return e?e.VisibleLayerTypes:Ue}],(function(e){return e||new Set})),Re={type:"SUBMIT_GET_ME_EVENT",payload:{}},Pe={type:"SUBMIT_LOGOUT_EVENT",payload:{}},De={type:"GET_USER_LAYERS_EVENT",payload:{}},Ce=r(38),Ve=r(216);function Me(e){var t=e.VisibleLayerTypesData,r=e.ToggleLayerTypeVisibilityAction,n=function(e,n){return a.a.createElement(_e.a,{control:a.a.createElement(ve.a,{checked:t.has(e),onChange:function(){return r(e)}}),label:n})};return a.a.createElement(Oe.a,{sx:{minWidth:275,position:"absolute",top:{xs:"50%",sm:"10%"},left:{xs:"50%",sm:"5%"},transform:{xs:"translate(-50%, -50%)",sm:"translate(0%, 0%)"}}},a.a.createElement(me.a,{style:{background:"#1A76D2"},variant:"dense"},a.a.createElement(de.a,Object(N.a)({variant:"h6",color:"inherit",component:"div"},"color","common.white"),"Humanitarian Map")),a.a.createElement(Te.a,null,a.a.createElement(ge.a,null,n(J.PUBLIC,"Public Layers"),n(J.PRIVATE,"Private Layers"),n(J.ACTIVE_FIRES,"Fire Points"),n(J.BIG_FIRES,"Big Fires \u2013 Historical Data"))))}var Be,Fe=Object(s.b)((function(e){return{VisibleLayerTypesData:Ge(e)}}),(function(e){return{ToggleLayerTypeVisibilityAction:function(t){return e(function(e){return{type:"TOGGLE_LAYER_TYPE_VISIBILITY",payload:{layerType:e}}}(t))}}}))((function(e){var t=e.isMenuVisible,r=e.setIsMenuVisible,n=Object(Ce.a)(),o=!Object(Ve.a)(n.breakpoints.up("sm")),c=a.a.createElement(Me,e);return console.log(o),o?a.a.createElement(ue.a,{open:t,onClose:function(){return r(!1)}},a.a.createElement("div",null,c)):c})),Ne=r(49),Ye=function(e){return e.response?e.response.data.detail||e.response.detail||Object.values(e.response.data)[0]:"Ups, we are having troubles connecting to the server. Please, try again later."},He=(Be={},Object(N.a)(Be,J.PUBLIC,(function(e){return e.is_public})),Object(N.a)(Be,J.PRIVATE,(function(e){return!e.is_public})),Object(N.a)(Be,J.ACTIVE_FIRES,(function(e){return["Firms Viirs","Firms Modis"].includes(e.name)})),Object(N.a)(Be,J.BIG_FIRES,(function(e){return"bigfires"===e.name})),Be);function Je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var We=Object(ce.b)({accessToken:"pk.eyJ1IjoiZW1pNDIwIiwiYSI6ImNqZW9leG5pZTAxYWwyeG83bHU0eHM0ZXcifQ.YWmk4Rp8FBGCLmpx_huJYw"}),qe=Object(s.b)((function(e){return{UserAuthData:Ae(e),GetMeData:xe(e),UserLayersData:ke(e),VisibleLayerTypesData:Ge(e)}}),(function(e){return{SubmitUserAuthAction:function(t,r){return e(function(e,t){return{type:"SUBMIT_USER_AUTH_EVENT",payload:{email:e,password:t}}}(t,r))},GetMeAction:function(){return e(Re)},LogOutAction:function(){return e(Pe)},GetUserLayersAction:function(){return e(De)}}}))(Object(Ne.e)((function(e){var t=Object(n.useState)(O),r=Object(te.a)(t,1)[0],o=Object(n.useState)([]),c=Object(te.a)(o,2),s=c[0],i=c[1],u=Object(n.useState)(!1),l=Object(te.a)(u,2),p=l[0],f=l[1],b=Object(n.useState)(!1),E=Object(te.a)(b,2),y=E[0],S=E[1],m=Object(n.useState)(null),d=Object(te.a)(m,2),T=d[0],g=d[1],_=Object(n.useState)(!1),v=Object(te.a)(_,2),h=v[0],j=v[1],L=Object(Y.a)(s);return Object(n.useEffect)((function(){e.GetMeAction(),e.GetUserLayersAction()}),[]),Object(n.useEffect)((function(){e.UserAuthData.error?(g(Ye(e.UserAuthData.error)),S(!1)):e.GetMeAction()}),[e.UserAuthData]),Object(n.useEffect)((function(){e.GetMeData.email?(f(!1),S(!1),e.GetUserLayersAction()):i([])}),[e.GetMeData.email]),Object(n.useEffect)((function(){e.UserLayersData.error||i(function(e,t){console.log(e,t);var r=Object(Y.a)(t).map((function(e){return He[e]}));return e.filter((function(e){return r.map((function(t){return t(e)})).some((function(e){return e}))}))}(e.UserLayersData,e.VisibleLayerTypesData).map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Je(r,!0).forEach((function(t){Object(N.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Je(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e,{},e.styles,{id:JSON.stringify(e.id),data:e.geojson_data})})))}),[e.UserLayersData,e.VisibleLayerTypesData]),a.a.createElement("div",null,a.a.createElement(We,{style:"mapbox://styles/mapbox/satellite-streets-v9",center:r,containerStyle:{height:"100vh",width:"100vw"},antialias:!0},a.a.createElement(se,{layers:L,hiddenLayers:[]})),a.a.createElement("div",{style:{position:"absolute",top:"15px",right:"15px"}},e.GetMeData.email?a.a.createElement(re.a,{onClick:e.LogOutAction,variant:"contained"},"Logout"):a.a.createElement(re.a,{onClick:function(){return f(!p)},variant:"contained"},"Login")),a.a.createElement(oe.a,{display:{xs:h?"block":"none",sm:"block"}},a.a.createElement(Fe,{isMenuVisible:h,setIsMenuVisible:j})),T&&a.a.createElement(ne.a,{open:T,autoHideDuration:6e3,onClose:function(){return g(null)}},a.a.createElement(ae.a,{onClose:function(){return g(null)},severity:"error",sx:{width:"100%"}},T)),p&&!e.UserAuthData.isLoggedIn&&a.a.createElement(be,{open:p,setOpen:f,onSubmit:function(t,r){S(!0),e.SubmitUserAuthAction(t,r)}}),y&&a.a.createElement(Se,null))}))),ze=r(81);r(166);var Ze=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(ze.a,null,a.a.createElement(Ne.a,{path:"",component:qe})))};r(167);c.a.render(a.a.createElement(s.a,{store:ee()},a.a.createElement(Ze,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[130,1,2]]]);
//# sourceMappingURL=main.47e870f7.chunk.js.map