(this.webpackJsonpeworkmap=this.webpackJsonpeworkmap||[]).push([[0],{129:function(e,t,r){e.exports=r(167)},165:function(e,t,r){},166:function(e,t,r){},167:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(33),c=r.n(o),i=r(56),s=r(52),u=r(112),l=r(32),p=r.n(l),f=r(29),b=r(108),y=r.n(b),m=r(109),E=r.n(m),d=function(){var e;return{getService:function(){return e||(e=this)},setToken:function(e){e.access&&localStorage.setItem("access_token",e.access),e.refresh&&localStorage.setItem("refresh_token",e.refresh)},getAccessToken:function(){return localStorage.getItem("access_token")},getRefreshToken:function(){return localStorage.getItem("refresh_token")},clearToken:function(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}}}(),O=d.getService(),S=[-64.273833,-31.006031],g=d.getService(),v=y.a.create({baseURL:"https://api.hmap.forodeincendiosforestales.org/api",withCredentials:!0});!function(e){e.interceptors.request.use((function(e){var t=O.getAccessToken();return t&&(e.headers.Authorization="Bearer "+t),e}),(function(e){Promise.reject(e)})),e.interceptors.response.use((function(e){return e}),(function(t){var r=t.config;if(403===t.response.status&&!r._retry){if(!O.getRefreshToken())throw t;return r._retry=!0,e.post("v1/token/refresh/",{refresh:O.getRefreshToken()}).then((function(t){if(200===t.status)return O.setToken(t.data),e.defaults.headers.common.Authorization="Bearer "+O.getAccessToken(),e(r)}))}return Promise.reject(t)}))}(v);var h={postAccountToken:function(e,t){return v.post("v1/token/",{email:e,password:t})},logout:function(){console.log(E.a.get()),g.clearToken()},getMe:function(){return v.get("v1/accounts/me/")},getUserLayers:function(){return v.get("v1/layers/")}},T=p.a.mark(k),j=p.a.mark(A),I=p.a.mark(x),_=p.a.mark(P),L=p.a.mark(D),w=p.a.mark(V),U=d.getService();function k(e){var t,r,n,a;return p.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,r=t.email,n=t.password,a={},o.prev=2,o.next=5,Object(f.b)(h.postAccountToken,r,n);case 5:a=o.sent,U.setToken(a.data),a.isLoggedIn=!0,o.next=13;break;case 10:o.prev=10,o.t0=o.catch(2),a={error:o.t0};case 13:return o.next=15,Object(f.c)({type:"SUBMIT_USER_AUTH_SUCCESS",payload:a});case 15:return o.abrupt("return",o.sent);case 16:case"end":return o.stop()}}),T,null,[[2,10]])}function A(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={isLoggedIn:!1},t.prev=1,t.next=4,Object(f.b)(h.logout);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),e={error:t.t0};case 9:return t.next=11,Object(f.c)({type:"SUBMIT_LOGOUT_SUCCESS",payload:e});case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),j,null,[[1,6]])}function x(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={},t.prev=1,t.next=4,Object(f.b)(h.getMe);case 4:e=t.sent.data,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),e={error:t.t0};case 10:return t.next=12,Object(f.c)({type:"SUBMIT_GET_ME_SUCCESS",payload:e});case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),I,null,[[1,7]])}function P(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={},t.prev=1,t.next=4,Object(f.b)(h.getUserLayers);case 4:e=t.sent.data,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),e={error:t.t0};case 10:return t.next=12,Object(f.c)({type:"SUBMIT_GET_USER_LAYERS_SUCCESS",payload:e});case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),_,null,[[1,7]])}function D(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.d)("SUBMIT_USER_AUTH_EVENT",k);case 2:return e.next=4,Object(f.d)("SUBMIT_GET_ME_EVENT",x);case 4:return e.next=6,Object(f.d)("SUBMIT_LOGOUT_EVENT",A);case 6:return e.next=8,Object(f.d)("GET_USER_LAYERS_EVENT",P);case 8:case"end":return e.stop()}}),L)}function V(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.a)([D()]);case 2:case"end":return e.stop()}}),w)}var R=r(4),C=r(19),G={PUBLIC:Symbol.for("LayerType.PUBLIC"),PRIVATE:Symbol.for("LayerType.PRIVATE"),ACTIVE_FIRES:Symbol.for("LayerType.ACTIVE_FIRES"),BIG_FIRES:Symbol.for("LayerType.BIG_FIRES"),all:function(){return new Set([G.PUBLIC,G.PRIVATE,G.ACTIVE_FIRES,G.BIG_FIRES])}},M=Object.freeze(G);function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(r,!0).forEach((function(t){Object(R.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var F=function(){var e=localStorage.getItem("VISIBLE_LAYERS_KEY");return e?new Set(JSON.parse(e).map(Symbol.for)):M.all()},N=function(e){return localStorage.setItem("VISIBLE_LAYERS_KEY",e&&JSON.stringify(Object(C.a)(e).map(Symbol.keyFor)))},H=function(){return localStorage.removeItem("VISIBLE_LAYERS_KEY")},J=function(){return{VisibleLayerTypes:F()}},W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SUBMIT_USER_AUTH_SUCCESS":return Y({},e,{UserAuthData:t.payload});case"SUBMIT_GET_ME_SUCCESS":return Y({},e,{GetMeData:t.payload});case"SUBMIT_LOGOUT_SUCCESS":if(!1===t.payload.isLoggedIn)return H(),J();case"SUBMIT_GET_USER_LAYERS_SUCCESS":return Y({},e,{UserLayersData:t.payload});case"TOGGLE_LAYER_TYPE_VISIBILITY":var r=t.payload.layerType,n=new Set(e.VisibleLayerTypes);return n.has(r)?n.delete(r):n.add(r),N(n),Y({},e,{VisibleLayerTypes:n});default:return e}},q=Object(u.a)();var z=function(){var e=Object(s.d)(W,Object(s.a)(q));return q.run(V),e};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Z=r(15),K=r(224),Q=r(220),X=r(218),$=r(223),ee=r(70),te=function(e){var t=[];return e.layers.map((function(r){-1===e.hiddenLayers.indexOf(r.id)&&(r.data?t.push(a.a.createElement(ee.a,{id:r.id,name:r.id,key:r.id,data:r.data||null,symbolLayout:r.symbolLayout,symbolPaint:r.symbolPaint,linePaint:r.linePaint,circlePaint:r.circlePaint,fillPaint:r.fillPaint,circleOnClick:function(e){console.log(e.lngLat)}})):t.push(r.layer))})),t},re={container:{display:"flex",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",alignItems:"center",justifyContent:"center",outline:"none"},form:{container:{background:"white",width:"400px",borderRadius:"8px",padding:"20px",boxShadow:"0 2px 4px rgba(0, 0, 0, .2), 0 8px 16px rgba(0, 0, 0, .2)"},inputs:{display:"flex",flexDirection:"column",gap:"10px"}}},ne=r(219),ae=r(216);function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ce(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(r,!0).forEach((function(t){Object(R.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ie=function(e){var t=e.open,r=e.setOpen,n=e.onSubmit;return a.a.createElement(ne.a,{disableEnforceFocus:!0,open:t,onClose:function(){return r(!1)}},a.a.createElement($.a,{sx:re.container},a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),n(e.target.email.value,e.target.password.value)},style:re.form.container},a.a.createElement("div",{style:ce({},re.form.inputs)},a.a.createElement(ae.a,{focused:!0,label:"Email",id:"email",name:"email",required:!0}),a.a.createElement(ae.a,{label:"Password",type:"password",id:"password",name:"password",required:!0}),a.a.createElement(K.a,{type:"submit"},"Login")))))},se=r(221),ue=r(225);var le=function(){return a.a.createElement(se.a,{sx:{color:"#fff",zIndex:function(e){return 9999}},open:!0},a.a.createElement(ue.a,{color:"inherit"}))},pe=r(229),fe=r(227),be=r(228),ye=r(230),me=r(231),Ee=r(226),de=r(222),Oe=r(64),Se=M.all(),ge=Object(Oe.a)([function(e){return e?e.UserAuthData:{}}],(function(e){return e||{}})),ve=Object(Oe.a)([function(e){return e?e.GetMeData:{}}],(function(e){return e||{}})),he=Object(Oe.a)([function(e){return e?e.UserLayersData:[]}],(function(e){return e||[]})),Te=Object(Oe.a)([function(e){return e?e.VisibleLayerTypes:Se}],(function(e){return e||new Set})),je={type:"SUBMIT_GET_ME_EVENT",payload:{}},Ie={type:"SUBMIT_LOGOUT_EVENT",payload:{}},_e={type:"GET_USER_LAYERS_EVENT",payload:{}},Le=r(38),we=r(215);function Ue(e){var t=e.VisibleLayerTypesData,r=e.ToggleLayerTypeVisibilityAction,n=function(e,n){return a.a.createElement(Ee.a,{control:a.a.createElement(de.a,{checked:t.has(e),onChange:function(){return r(e)}}),label:n})};return a.a.createElement(be.a,{sx:{minWidth:275,position:"absolute",top:{xs:"50%",sm:"10%"},left:{xs:"50%",sm:"5%"},transform:{xs:"translate(-50%, -50%)",sm:"translate(0%, 0%)"}}},a.a.createElement(pe.a,{style:{background:"#1A76D2"},variant:"dense"},a.a.createElement(fe.a,Object(R.a)({variant:"h6",color:"inherit",component:"div"},"color","common.white"),"Humanitarian Map")),a.a.createElement(ye.a,null,a.a.createElement(me.a,null,n(M.PUBLIC,"Public Layers"),n(M.PRIVATE,"Private Layers"),n(M.ACTIVE_FIRES,"Fire Points"),n(M.BIG_FIRES,"Big Fires \u2013 Historical Data"))))}var ke,Ae=Object(i.b)((function(e){return{VisibleLayerTypesData:Te(e)}}),(function(e){return{ToggleLayerTypeVisibilityAction:function(t){return e(function(e){return{type:"TOGGLE_LAYER_TYPE_VISIBILITY",payload:{layerType:e}}}(t))}}}))((function(e){var t=e.isMenuVisible,r=e.setIsMenuVisible,n=Object(Le.a)(),o=!Object(we.a)(n.breakpoints.up("sm")),c=a.a.createElement(Ue,e);return o?a.a.createElement(ne.a,{open:t,onClose:function(){return r(!1)}},a.a.createElement("div",null,c)):c})),xe=r(49),Pe=function(e){return e.response?e.response.data.detail||e.response.detail||Object.values(e.response.data)[0]:"Ups, we are having troubles connecting to the server. Please, try again later."},De=(ke={},Object(R.a)(ke,M.PUBLIC,(function(e){return e.is_public&&"bigfires"!==e.name})),Object(R.a)(ke,M.PRIVATE,(function(e){return!e.is_public})),Object(R.a)(ke,M.ACTIVE_FIRES,(function(e){return["Firms Viirs","Firms Modis"].includes(e.name)})),Object(R.a)(ke,M.BIG_FIRES,(function(e){return"bigfires"===e.name})),ke);function Ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var Re=Object(ee.b)({accessToken:"pk.eyJ1IjoiZW1pNDIwIiwiYSI6ImNqZW9leG5pZTAxYWwyeG83bHU0eHM0ZXcifQ.YWmk4Rp8FBGCLmpx_huJYw"}),Ce=Object(i.b)((function(e){return{UserAuthData:ge(e),GetMeData:ve(e),UserLayersData:he(e),VisibleLayerTypesData:Te(e)}}),(function(e){return{SubmitUserAuthAction:function(t,r){return e(function(e,t){return{type:"SUBMIT_USER_AUTH_EVENT",payload:{email:e,password:t}}}(t,r))},GetMeAction:function(){return e(je)},LogOutAction:function(){return e(Ie)},GetUserLayersAction:function(){return e(_e)}}}))(Object(xe.e)((function(e){var t=Object(n.useState)(S),r=Object(Z.a)(t,1)[0],o=Object(n.useState)([]),c=Object(Z.a)(o,2),i=c[0],s=c[1],u=Object(n.useState)(!1),l=Object(Z.a)(u,2),p=l[0],f=l[1],b=Object(n.useState)(!1),y=Object(Z.a)(b,2),m=y[0],E=y[1],d=Object(n.useState)(null),O=Object(Z.a)(d,2),g=O[0],v=O[1],h=Object(n.useState)(!1),T=Object(Z.a)(h,2),j=T[0],I=T[1],_=Object(C.a)(i);return Object(n.useEffect)((function(){e.GetMeAction(),e.GetUserLayersAction()}),[]),Object(n.useEffect)((function(){e.UserAuthData.error?(v(Pe(e.UserAuthData.error)),E(!1)):e.GetMeAction()}),[e.UserAuthData]),Object(n.useEffect)((function(){e.GetMeData.email?(f(!1),E(!1),e.GetUserLayersAction()):s([])}),[e.GetMeData.email]),Object(n.useEffect)((function(){e.UserLayersData.error||s(function(e,t){var r=Object(C.a)(t).map((function(e){return De[e]}));return e.filter((function(e){return r.map((function(t){return t(e)})).some((function(e){return e}))}))}(e.UserLayersData,e.VisibleLayerTypesData).map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ve(r,!0).forEach((function(t){Object(R.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ve(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e,{},e.styles,{id:JSON.stringify(e.id),data:e.geojson_data})})))}),[e.UserLayersData,e.VisibleLayerTypesData]),a.a.createElement("div",null,a.a.createElement(Re,{style:"mapbox://styles/mapbox/satellite-streets-v9",center:r,containerStyle:{height:"100vh",width:"100vw"},antialias:!0},a.a.createElement(te,{layers:_,hiddenLayers:[]})),a.a.createElement("div",{style:{position:"absolute",top:"15px",right:"15px"}},e.GetMeData.email?a.a.createElement(K.a,{onClick:e.LogOutAction,variant:"contained"},"Logout"):a.a.createElement(K.a,{onClick:function(){return f(!p)},variant:"contained"},"Login")),a.a.createElement($.a,{display:{xs:j?"block":"none",sm:"block"}},a.a.createElement(Ae,{isMenuVisible:j,setIsMenuVisible:I})),g&&a.a.createElement(Q.a,{open:g,autoHideDuration:6e3,onClose:function(){return v(null)}},a.a.createElement(X.a,{onClose:function(){return v(null)},severity:"error",sx:{width:"100%"}},g)),p&&!e.UserAuthData.isLoggedIn&&a.a.createElement(ie,{open:p,setOpen:f,onSubmit:function(t,r){E(!0),e.SubmitUserAuthAction(t,r)}}),m&&a.a.createElement(le,null))}))),Ge=r(81);r(165);var Me=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(Ge.a,null,a.a.createElement(xe.a,{path:"",component:Ce})))};r(166);c.a.render(a.a.createElement(i.a,{store:z()},a.a.createElement(Me,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[129,1,2]]]);
//# sourceMappingURL=main.d3e3a275.chunk.js.map